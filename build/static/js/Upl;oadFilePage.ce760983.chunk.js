(this["webpackJsonpscraping-penguins-frontend-template"]=this["webpackJsonpscraping-penguins-frontend-template"]||[]).push([[13],{615:function(e,t,o){"use strict";o.r(t);var s=o(0),n=o(242),c=o(591),a=o(239),l=o(51),r=o(1),i=o(594),d=o(7);function p(e){let{onFileUpload:t}=e;const o=Object(s.useCallback)((e=>{if(1===e.length){const o=e[0];"text/csv"===o.type||"application/vnd.ms-excel"===o.type?t(o):alert("Please upload a CSV file.")}else alert("Please upload only one file.")}),[t]),{getRootProps:n,getInputProps:c}=Object(i.a)({onDrop:o});return Object(d.jsxs)("div",Object(r.a)(Object(r.a)({},n()),{},{style:u,children:[Object(d.jsx)("input",Object(r.a)({},c())),Object(d.jsx)("p",{children:"Drag 'n' drop a CSV file here, or click to select one"})]}))}const u={border:"2px dashed #ccc",borderRadius:"4px",padding:"20px",width:"100%",height:"300px",textAlign:"center",cursor:"pointer"};var j=o(241),x=o(590),m=o(607);var b=e=>{let{documents:t}=e;const o=e=>{const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString()}},s=e=>{const t=Math.floor(e/1e3%60),o=Math.floor(e/6e4%60),s=Math.floor(e/36e5),n=[];return s>0&&n.push("".concat(s," hour").concat(s>1?"s":"")),o>0&&n.push("".concat(o," minute").concat(o>1?"s":"")),(t>0||0===s&&0===o)&&n.push("".concat(t," second").concat(t>1?"s":"")),n.join(" ")},n=[{title:"Index",dataIndex:"index",key:"index"},{title:"Uploaded Date",dataIndex:"uploadeddate",key:"uploadeddate",render:e=>{const{date:t,time:s}=o(e);return Object(d.jsx)("span",{children:"".concat(t," ").concat(s)})}},{title:"Completed Date",dataIndex:"completeddate",key:"completeddate",render:(e,t)=>{const{date:s,time:n}=o(e);return Object(d.jsx)("span",{children:"processing"===t.status?"":"".concat(s," ").concat(n)})}},{title:"Status",dataIndex:"status",key:"status",render:e=>Object(d.jsx)("span",{children:e})},{title:"Processing time",dataIndex:"processingTime",key:"processingTime",render:e=>Object(d.jsx)("span",{children:s(e)})},{title:"Proxy request count",dataIndex:"requestCount",key:"requestCount"},{title:"Total rows",dataIndex:"totalRows",key:"totalRows"},{title:"Download",dataIndex:"status",key:"status",render:(e,t)=>Object(d.jsx)(d.Fragment,{children:"completed"===e?Object(d.jsx)(a.a,{type:"primary",onClick:()=>{(e=>{if(e){const t=new Blob([e.fileContent],{type:"text/csv"}),o=window.URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download="output-data.csv",document.body.appendChild(s),s.click(),document.body.removeChild(s)}})(t)},children:"Download File"}):"cancelled"===e?Object(d.jsx)("span",{children:"Cancelled"}):Object(d.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:t.rowsProcessed?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(x.a,{percent:t.processedPErcentage?t.processedPErcentage:0,size:"small"}),"Processing ",t.rowsProcessed,"/",t.totalRows,Object(d.jsx)(a.a,{type:"primary",style:{marginTop:"10px"},onClick:()=>{(async e=>{try{const t=await fetch("".concat(l.b,"cancelprocessing/").concat(e._id),{method:"GET"});t.ok?await t.json():console.error("Error cancelling processing:",t.statusText)}catch(t){console.error("Error:",t.message)}})(t)},children:"Cancel"})]}):Object(d.jsx)(j.a,{size:"small"})})})}];if(null===t||void 0===t||!t.length)return Object(d.jsx)("span",{children:"No previous data to show!"});const c=t.map(((e,t)=>({_id:e._id,index:t.toString(),uploadeddate:e.createdAt,completeddate:e.completedAt,status:e.status,fileContent:e.fileContent,processedPErcentage:e.processedPErcentage,rowsProcessed:e.rowsProcessed,totalRows:e.totalRows,processingTime:e.processingTime,requestCount:e.requestCount})));return Object(d.jsx)(m.a,{rowKey:e=>e.index,dataSource:c,columns:n})};const{Content:h}=n.a,g={content:{padding:"0px 16px 16px 16px",margin:"50px auto",width:"100%",minHeight:"600px",maxWidth:"1200px",alignItems:"center",display:"flex",flexDirection:"column"}};t.default=()=>{const[e,t]=Object(s.useState)(null),[o,r]=Object(s.useState)(!1),[i,u]=Object(s.useState)(null),[m,w]=Object(s.useState)([]),[f,y]=Object(s.useState)({}),[O,v]=Object(s.useState)(0);Object(s.useEffect)((()=>{let e;return i&&(e=setInterval((async()=>{const o=await fetch("".concat(l.b,"documentstatus/").concat(i),{method:"GET"});if(o.ok){const s=await o.json();if("completed"===s.status)t(s.fileContent),u(null),r(!1),clearInterval(e);else{const e={totalRows:null!==s&&void 0!==s&&s.totalRows?null===s||void 0===s?void 0:s.totalRows:0,rowsProcessed:null!==s&&void 0!==s&&s.rowsProcessed?null===s||void 0===s?void 0:s.rowsProcessed:0,status:null!==s&&void 0!==s&&s.status?null===s||void 0===s?void 0:s.status:"processing"},t=((null===s||void 0===s?void 0:s.rowsProcessed)/(null===s||void 0===s?void 0:s.totalRows)*100).toFixed(2);v(t),y(e)}}}),1e3)),C(),()=>clearInterval(e)}),[i]);const C=async()=>{const e=await fetch("".concat(l.b,"documents/"),{method:"GET"});if(e.ok){const t=await e.json(),o=t.data;o.forEach((e=>{e.processedPErcentage=(e.rowsProcessed/e.totalRows*100).toFixed(2)})),w(o);t.data.some((e=>"processing"===e.status))&&setTimeout(C,1e3)}};Object(s.useEffect)((()=>{C()}),[]);return console.log("Processing info",f),Object(d.jsx)(n.a,{className:"site-layout",children:Object(d.jsxs)(h,{className:"site-layout-background",style:g.content,children:[Object(d.jsx)(c.a,{title:"Upload CSV file",onBack:()=>{r(!1),t(null)},ghost:!1,style:{alignSelf:"flex-start",padding:"20px 0px"}}),"cancelled"!==f.status&&o&&Object(d.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center"},children:[Object(d.jsx)(j.a,{size:"large"}),f.totalRows>0&&Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("div",{style:{marginTop:"46px",marginBottom:"50px"},children:"Processing ".concat(f.rowsProcessed,"/").concat(f.totalRows," rows. Please wait...")}),Object(d.jsx)(x.a,{type:"circle",percent:O,style:{marginTop:"16px",marginBottom:"50px",marginLeft:"55px"}})]})]}),e&&!o?Object(d.jsx)(a.a,{type:"primary",onClick:()=>(e=>{if(e){const t=new Blob([e],{type:"text/csv"}),o=window.URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download="output-data.csv",document.body.appendChild(s),s.click(),document.body.removeChild(s)}})(e),children:"Download File"}):Object(d.jsx)(d.Fragment,{children:!o&&Object(d.jsx)(p,{onFileUpload:async e=>{r(!0);try{const o=new FormData;o.append("file",e);const s=await fetch("".concat(l.b,"uploadFile"),{method:"POST",body:o});if(s.ok){const e=await s.json();u(null===e||void 0===e?void 0:e.result._id),t(e.fileContent)}else console.error("Error uploading file:",s.statusText)}catch(o){console.error("Error:",o.message)}}})}),m.length>0&&Object(d.jsx)("div",{style:{display:"flex",marginTop:"30px"},children:Object(d.jsx)(b,{documents:m})})]})})}}}]);
//# sourceMappingURL=Upl;oadFilePage.ce760983.chunk.js.map